<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘æµæ’­æ”¾å™¨</title>
    <style>
        /* æ’­æ”¾å™¨å®¹å™¨ */
        .video-player-container {
            max-width: 800px;
            margin: 20px auto;
            background: #000;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* è§†é¢‘å…ƒç´  */
        .video-player {
            width: 100%;
            display: block;
        }
        
        /* æ§åˆ¶æ  */
        .video-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            transition: opacity 0.3s;
        }
        
        /* éšè—æ§åˆ¶æ æ—¶çš„çŠ¶æ€ */
        .video-player-container:hover .video-controls {
            opacity: 1;
        }
        .video-controls {
            opacity: 0;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
        }
        
        /* è¿›åº¦æ¡å®¹å™¨ */
        .progress-container {
            flex: 1;
            height: 20px;
            position: relative;
            margin: 0 10px;
            cursor: pointer;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-bar {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            border-radius: 2px;
            background: #ff0000;
            width: 0;
        }
        
        /* ç¼“å†²æ¡ */
        .buffered-bar {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 4px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.3);
            width: 0;
        }
        
        /* æ—¶é—´æ˜¾ç¤º */
        .time-display {
            font-size: 12px;
            margin-left: 10px;
            min-width: 100px;
            text-align: center;
        }
        
        /* éŸ³é‡æ§åˆ¶ */
        .volume-control {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
        
        /* å…¨å±æŒ‰é’® */
        .fullscreen-btn {
            margin-left: auto;
        }
        
        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            display: none;
        }
    </style>
</head>
<body>
    <div class="video-player-container">
        <video class="video-player" id="videoPlayer">
            <!-- è§†é¢‘æºå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </video>
        
        <div class="loading-indicator" id="loadingIndicator">
            åŠ è½½ä¸­...
        </div>
        
        <div class="video-controls">
            <button class="control-btn play-pause-btn" id="playPauseBtn">â–¶</button>
            
            <div class="progress-container" id="progressContainer">
                <div class="buffered-bar" id="bufferedBar"></div>
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
            
            <div class="volume-control">
                <button class="control-btn volume-btn" id="volumeBtn">ğŸ”Š</button>
                <input type="range" min="0" max="1" step="0.1" value="1" id="volumeSlider">
            </div>
            
            <button class="control-btn fullscreen-btn" id="fullscreenBtn">â›¶</button>
        </div>
    </div>
    
    <div style="text-align: center; margin: 20px;">
        <button id="stream1Btn">åŠ è½½ç›´æ’­æµ1 (HLS)</button>
        <button id="stream2Btn">åŠ è½½ç›´æ’­æµ2 (DASH)</button>
        <button id="stream3Btn">åŠ è½½ç›´æ’­æµ3 (RTMP)</button>
    </div>

    <script>
        // è·å–DOMå…ƒç´ 
        const videoPlayer = document.getElementById('videoPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const bufferedBar = document.getElementById('bufferedBar');
        const progressContainer = document.getElementById('progressContainer');
        const timeDisplay = document.getElementById('timeDisplay');
        const volumeBtn = document.getElementById('volumeBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const fullscreenBtn = document.getElementById('fullscreenBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        
        // è§†é¢‘æµæº
        const videoStreams = {
            hls: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
            dash: 'https://dash.akamaized.net/envivio/EnvivioDash3/manifest.mpd',
            rtmp: 'rtmp://184.72.239.149/vod/BigBuckBunny_115k.mov'
        };
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        function initPlayer() {
            // æ’­æ”¾/æš‚åœåˆ‡æ¢
            playPauseBtn.addEventListener('click', togglePlayPause);
            
            // è¿›åº¦æ¡ç‚¹å‡»è·³è½¬
            progressContainer.addEventListener('click', seek);
            
            // éŸ³é‡æ§åˆ¶
            volumeSlider.addEventListener('input', setVolume);
            volumeBtn.addEventListener('click', toggleMute);
            
            // å…¨å±æ§åˆ¶
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            
            // è§†é¢‘äº‹ä»¶ç›‘å¬
            videoPlayer.addEventListener('timeupdate', updateProgress);
            videoPlayer.addEventListener('progress', updateBuffered);
            videoPlayer.addEventListener('waiting', showLoading);
            videoPlayer.addEventListener('playing', hideLoading);
            videoPlayer.addEventListener('ended', onVideoEnded);
            
            // åŠ è½½é»˜è®¤æµ
            loadStream(videoStreams.hls);
        }
        
        // åŠ è½½è§†é¢‘æµ
        function loadStream(streamUrl) {
            showLoading();
            
            // æ¸…é™¤æ—§æº
            videoPlayer.src = '';
            
            // æ£€æµ‹æµç±»å‹å¹¶è®¾ç½®ç›¸åº”æº
            if (streamUrl.endsWith('.m3u8')) {
                // HLSæµ
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(streamUrl);
                    hls.attachMedia(videoPlayer);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.play();
                    });
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    // SafariåŸç”Ÿæ”¯æŒ
                    videoPlayer.src = streamUrl;
                    videoPlayer.addEventListener('loadedmetadata', function() {
                        videoPlayer.play();
                    });
                } else {
                    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒHLSæµæ’­æ”¾');
                }
            } else if (streamUrl.endsWith('.mpd')) {
                // DASHæµ
                if (typeof dashjs !== 'undefined') {
                    const player = dashjs.MediaPlayer().create();
                    player.initialize(videoPlayer, streamUrl, true);
                    player.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, function() {
                        videoPlayer.play();
                    });
                } else {
                    alert('è¯·å…ˆåŠ è½½dash.jsåº“ä»¥æ”¯æŒDASHæµæ’­æ”¾');
                }
            } else if (streamUrl.startsWith('rtmp://')) {
                // RTMPæµ (éœ€è¦Flashæˆ–è½¬ç )
                alert('RTMPæµéœ€è¦Flashæ”¯æŒæˆ–è½¬æ¢ä¸ºHLS/DASHæ ¼å¼');
            } else {
                // å¸¸è§„è§†é¢‘æ–‡ä»¶
                videoPlayer.src = streamUrl;
                videoPlayer.addEventListener('loadedmetadata', function() {
                    videoPlayer.play();
                });
            }
        }
        
        // æ’­æ”¾/æš‚åœåˆ‡æ¢
        function togglePlayPause() {
            if (videoPlayer.paused) {
                videoPlayer.play();
                playPauseBtn.textContent = 'âšâš';
            } else {
                videoPlayer.pause();
                playPauseBtn.textContent = 'â–¶';
            }
        }
        
        // è·³è½¬åˆ°æŒ‡å®šæ—¶é—´
        function seek(e) {
            const rect = progressContainer.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            videoPlayer.currentTime = pos * videoPlayer.duration;
        }
        
        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const percent = (videoPlayer.currentTime / videoPlayer.duration) * 100;
            progressBar.style.width = percent + '%';
            updateTimeDisplay();
        }
        
        // æ›´æ–°ç¼“å†²æ¡
        function updateBuffered() {
            if (videoPlayer.buffered.length > 0) {
                const bufferedEnd = videoPlayer.buffered.end(videoPlayer.buffered.length - 1);
                const percent = (bufferedEnd / videoPlayer.duration) * 100;
                bufferedBar.style.width = percent + '%';
            }
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const formatTime = (time) => {
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                return minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
            };
            
            timeDisplay.textContent = formatTime(videoPlayer.currentTime) + ' / ' + formatTime(videoPlayer.duration);
        }
        
        // è®¾ç½®éŸ³é‡
        function setVolume() {
            videoPlayer.volume = volumeSlider.value;
            volumeBtn.textContent = videoPlayer.volume === 0 ? 'ğŸ”‡' : 'ğŸ”Š';
        }
        
        // é™éŸ³åˆ‡æ¢
        function toggleMute() {
            videoPlayer.muted = !videoPlayer.muted;
            volumeBtn.textContent = videoPlayer.muted ? 'ğŸ”‡' : 'ğŸ”Š';
            volumeSlider.value = videoPlayer.muted ? 0 : videoPlayer.volume;
        }
        
        // å…¨å±åˆ‡æ¢
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen().catch(err => {
                    alert(`å…¨å±é”™è¯¯: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoading() {
            loadingIndicator.style.display = 'block';
        }
        
        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideLoading() {
            loadingIndicator.style.display = 'none';
        }
        
        // è§†é¢‘ç»“æŸå¤„ç†
        function onVideoEnded() {
            playPauseBtn.textContent = 'â–¶';
        }
        
        // æµé€‰æ‹©æŒ‰é’®äº‹ä»¶
        document.getElementById('stream1Btn').addEventListener('click', () => {
            loadStream(videoStreams.hls);
        });
        
        document.getElementById('stream2Btn').addEventListener('click', () => {
            loadStream(videoStreams.dash);
        });
        
        document.getElementById('stream3Btn').addEventListener('click', () => {
            loadStream(videoStreams.rtmp);
        });
        
        // åˆå§‹åŒ–æ’­æ”¾å™¨
        initPlayer();
    </script>
    
    <!-- å¼•å…¥HLS.jsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <!-- å¼•å…¥DASH.jsåº“ -->
    <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
</body>
</html>
